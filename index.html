<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –†–æ–∑—ã–≥—Ä—ã—à –°–∫–∏–¥–æ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> 
    <style>
        /* --- –§–û–ù --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: #fff; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            
            background: linear-gradient(180deg, #191970 0%, #4B0082 70%, #8B0000 100%); 
            background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 40px), 
                              radial-gradient(white, rgba(255,255,255,.1) 1px, transparent 30px), 
                              radial-gradient(white, rgba(255,255,255,.1) 3px, transparent 60px);
            background-size: 500px 500px, 300px 300px, 600px 600px;
            animation: snow1 15s linear infinite, snow2 20s linear infinite, snow3 25s linear infinite;
        }
        @keyframes snow1 { from { background-position: 0 0, 0 0, 0 0; } to { background-position: 500px 500px, 300px 300px, 600px 600px; } }
        @keyframes snow2 { from { background-position: 0 0, 0 0, 0 0; } to { background-position: -500px -500px, -300px -300px, -600px -600px; } }
        @keyframes snow3 { from { background-position: 0 0, 0 0, 0 0; } to { background-position: 250px 250px, 150px 150px, 300px 300px; } }

        /* --- –ö–û–ù–¢–ï–ô–ù–ï–† --- */
        .container {
            background: #ffffff; 
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 100%;
            text-align: center;
            color: #333; 
        }
        h1 { color: #C0392B; margin-bottom: 10px; }
        p.instruction { color: #6c757d; margin-bottom: 30px; }

        /* --- –°–ö–†–ï–¢–ß-–ö–ê–†–¢–ê --- */
        #scratch-card-container {
            width: 300px;
            height: 150px;
            margin: 0 auto 30px;
            background-color: #eee;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            font-weight: bold;
            color: #008000; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        #scratch-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #8B0000; 
            border-radius: 10px;
            background-image: radial-gradient(circle at center, #E67E22 10%, #C0392B 100%);
            background-size: 100% 100%; 
            cursor: pointer;
            opacity: 1; 
            transition: opacity 0.1s linear; 
        }
        #scratch-layer.scratched-all {
            opacity: 0 !important;
            cursor: default;
            transition: opacity 0.5s ease-out;
        }

        /* --- –†–ï–ó–£–õ–¨–¢–ê–¢ --- */
        .result-area { 
            display: none; 
            margin-top: 25px; 
            padding: 20px; 
            border: 2px solid #008000; 
            background-color: #e6ffe6; 
            color: #155724; 
            border-radius: 10px; 
            text-align: center; 
        }
        .result-area p { 
            font-size: 1.1em; 
            font-weight: bold; 
            color: #000; 
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üéâ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –†–æ–∑—ã–≥—Ä—ã—à –°–∫–∏–¥–æ–∫!</h1>
    <p class="instruction" id="instruction-text">
        –°–æ—Ç—Ä–∏—Ç–µ –∑–∞—â–∏—Ç–Ω—ã–π —Å–ª–æ–π, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–∞–∫—É—é —Å–∫–∏–¥–∫—É –≤—ã –≤—ã–∏–≥—Ä–∞–ª–∏!
    </p>
    
    <div id="scratch-card-container">
        <span id="prize-text"></span> 
        <div id="scratch-layer"></div>
    </div>
    
    <div id="result-area" class="result-area">
    </div>
</div>

<script>
    // --- 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ü—Ä–∏–∑–æ–≤ (–¢–æ–ª—å–∫–æ —Å–∫–∏–¥–∫–∏) ---
    const PRIZE_WEIGHTS = [
        { prize: "–°–∫–∏–¥–∫–∞ 30%", weight: 1000 }, 
        { prize: "–°–∫–∏–¥–∫–∞ 20%", weight: 2500 }, 
        { prize: "–°–∫–∏–¥–∫–∞ 15%", weight: 3000 }, 
        { prize: "–°–∫–∏–¥–∫–∞ 10%", weight: 3500 } // –°–ª–µ–≥–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω —à–∞–Ω—Å
    ];
    const TOTAL_WEIGHT = 10000; // –û–±—â–∏–π –≤–µ—Å, –≤–∫–ª—é—á–∞—è –∑–∞–ø–∞—Å (10000 - 1000 - 2500 - 3000 - 3500 = 0)
    
    const SCRATCH_LAYER = document.getElementById('scratch-layer');
    const PRIZE_TEXT_ELEM = document.getElementById('prize-text');
    const RESULT_AREA = document.getElementById('result-area');
    const INSTRUCTION = document.getElementById('instruction-text');

    let isScratching = false;
    let finalPrize = "";
    let timerStarted = false; 
    let opacityValue = 1.0; 
    const OPACITY_DECREASE = 0.05; 
    const TIMER_DELAY = 4000; // 4 —Å–µ–∫—É–Ω–¥—ã

    // --- 2. –§—É–Ω–∫—Ü–∏—è –≤–∑–≤–µ—à–µ–Ω–Ω–æ–≥–æ —Ä–∞–Ω–¥–æ–º–∞ –¥–ª—è –ø—Ä–∏–∑–∞ ---
    function getWeightedRandomPrize() {
        const randomValue = Math.floor(Math.random() * TOTAL_WEIGHT) + 1;
        let currentSum = 0;
        for (const item of PRIZE_WEIGHTS) {
            currentSum += item.weight;
            if (randomValue <= currentSum) {
                return item.prize;
            }
        }
        return PRIZE_WEIGHTS[PRIZE_WEIGHTS.length - 1].prize; // –ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ
    }

    // --- 3. –õ–æ–≥–∏–∫–∞ —Å—Ç–∏—Ä–∞–Ω–∏—è ---
    function startScratching(e) {
        e.preventDefault(); 
        if (SCRATCH_LAYER.classList.contains('scratched-all')) return;

        isScratching = true;

        if (!timerStarted) {
            timerStarted = true;
            
            setTimeout(() => {
                if (!SCRATCH_LAYER.classList.contains('scratched-all')) {
                    revealPrize();
                }
            }, TIMER_DELAY); 
        }
        scratch(e); 
    }

    function stopScratching() {
        isScratching = false;
    }

    function scratch(e) {
        if (!isScratching || SCRATCH_LAYER.classList.contains('scratched-all')) return;

        opacityValue = Math.max(0, opacityValue - OPACITY_DECREASE);
        SCRATCH_LAYER.style.opacity = opacityValue;
        
        if (opacityValue < 0.2) { 
            revealPrize();
        }
    }

    function revealPrize() {
        SCRATCH_LAYER.classList.add('scratched-all'); 
        
        SCRATCH_LAYER.removeEventListener('mousedown', startScratching);
        SCRATCH_LAYER.removeEventListener('mousemove', scratch);
        SCRATCH_LAYER.removeEventListener('mouseup', stopScratching);
        SCRATCH_LAYER.removeEventListener('touchstart', startScratching);
        SCRATCH_LAYER.removeEventListener('touchmove', scratch);
        SCRATCH_LAYER.removeEventListener('touchend', stopScratching);

        displayResult(finalPrize);
    }

    // --- 4. –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ---
    function displayResult(prize) {
        const headerText = `üéÅ –í–∞—à –ø—Ä–∏–∑: ${prize}!`;
        const instructionText = '–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω —Å–∫–∏–¥–∫–∏ –∏ –ø–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–¥–∞–≤—Ü—É.';

        RESULT_AREA.innerHTML = `
            <h2>${headerText}</h2>
            <p>${instructionText}</p>
        `;
        RESULT_AREA.style.display = 'block';
        INSTRUCTION.textContent = '–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! –í–∞—à–∞ –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞.';
    }

    // --- 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã (–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑) ---
    function initializeGame() {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TMA
        if (window.Telegram && window.Telegram.WebApp) {
             window.Telegram.WebApp.ready();
        }
        
        finalPrize = getWeightedRandomPrize();
        PRIZE_TEXT_ELEM.textContent = finalPrize.toUpperCase();

        SCRATCH_LAYER.addEventListener('mousedown', startScratching);
        SCRATCH_LAYER.addEventListener('mousemove', scratch);
        SCRATCH_LAYER.addEventListener('mouseup', stopScratching);
        SCRATCH_LAYER.addEventListener('touchstart', startScratching);
        SCRATCH_LAYER.addEventListener('touchmove', scratch);
        SCRATCH_LAYER.addEventListener('touchend', stopScratching);
        
        document.addEventListener('mouseup', stopScratching);
        document.addEventListener('touchend', stopScratching);
    }

    window.onload = function() {
        initializeGame(); 
    };
</script>

</body>
</html>
